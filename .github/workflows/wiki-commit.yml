name: Update Wiki

permissions:
  contents: write

env:
  REPO_WIKI_PATH: docs/wiki
  MASTER_BRANCH: master

on:
  push:
    paths:
      - "docs/wiki/**"
      - ".github/workflows/wiki-commit.yml"

jobs:
  wiki-commit:
    runs-on: ubuntu-latest
    steps:
      - id: repository
        run: echo "name=${GITHUB_REPOSITORY#${GITHUB_REPOSITORY_OWNER}/}" >> $GITHUB_OUTPUT

      # 1. ãƒ¡ã‚¤ãƒ³ãƒªãƒã‚¸ãƒˆãƒªï¼ˆowner/repoï¼‰ã‚’ clone
      - name: Checkout Main Repository
        uses: actions/checkout@v4
        with:
          path: "${{ steps.repository.outputs.name }}"

      # 2. Wiki ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ï¼ˆåˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã‚¯ãƒ­ãƒ¼ãƒ³ï¼‰
      - name: Checkout Wiki Repository
        uses: actions/checkout@v4
        with:
          repository: "${{ github.repository }}.wiki"
          path: wiki
          token: ${{ secrets.GITHUB_TOKEN }}

      # 3. docs/wiki/** ã®å†…å®¹ã‚’ Wiki ãƒªãƒã‚¸ãƒˆãƒªã«ã‚³ãƒ”ãƒ¼
      - name: Copy Updated Docs to Wiki
        run: |
          rsync -a --delete --exclude='.git' "${{ steps.repository.outputs.name }}/${{ env.REPO_WIKI_PATH }}/" wiki/

      # 4. Wiki ãƒªãƒã‚¸ãƒˆãƒªã®å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
      - name: Commit and Push Changes to Wiki
        run: |
          cd wiki
          git config --global user.email "bot@example.com"
          git config --global user.name "bot"
          git add -A
          git commit -m 'ğŸ¤–: Update wiki by bot' || echo "No changes to commit"
          git push origin ${{ env.MASTER_BRANCH }}
